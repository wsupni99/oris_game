# Задачи: JavaFX Socket Game (Gartic-подобная)

## Эпик: Подготовка
- [x] Утвердить стек: Java 17+, JavaFX, чистые TCP-сокеты
- [x] Создать общий репозиторий, настроить gradle/maven-проект
- [x] Описать протокол (типы сообщений, формат JSON, ошибки)

---

## Эпик: Сервер (Даня)

### ✅ Блок: Базовая сеть и модель
- [x] Поднять ServerSocket (порт 8080, ~~конфиг в properties~~ без пропертис)
- [x] Реализовать класс Player (id, имя, состояние, socket, потоки)
- [x] Реализовать GameState (roomId, режим, список игроков, раунд, таймер)
- [x] Сделать пул потоков ExecutorService для клиентов
- [x] Реализовать цикл приёма/отправки сообщений клиенту

### ✅ Блок: Протокол и сообщения
- [x] Определить enum MessageType (JOIN, CHAT, DRAW, GUESS, READY, START, TEXT_SUBMIT, ROUND_UPDATE, FINAL_CHAIN, ERROR)
- [x] Описать формат JSON-сообщений (type, roomId, payload)
- [x] Написать парсер/обёртку над ObjectInputStream/ObjectOutputStream для JSON
- [x] Обработчик JOIN/LEAVE (подключение, отключение, рассылка обновлённого списка игроков)
- [x] Обработчик CHAT (широковещательно в комнату)
- [x] Обработчик DRAW (ретрансляция мазков всем игрокам комнаты)
- [x] Обработчик GUESS (сравнение с загаданным словом, отправка CORRECT)
- [x] Обработчик READY/START (логика готовности и запуска раунда)
- [x] Обработчик TEXT_SUBMIT/ROUND_UPDATE (логика “глухого телефона”: сдвиги текст/рисунок)

### ✅ Блок: Логика режимов
- [x] Режим 1: Угадай рисунок (создание комнаты, установка слова, проверка угадывания, завершение раунда)
- [x] Режим 2: Глухой телефон (создание цепочек, хранение текста и рисунков по игрокам и шагам)
- [x] Реализовать таймер раундов (ScheduledExecutorService)
- [x] Отправка FINAL_CHAIN с полной последовательностью всем участникам
- [x] Обработка ошибок протокола (неизвестный тип, некорректные данные)

### ✅ Блок: Технический долг и тесты
- [x] Логика сервера и режимов
- [x] Написать простого консольного тест-клиента для проверки протокола без UI

---

## Эпик: Клиент (Артур)

### Блок: Общий каркас JavaFX
- [ ] Создать основной класс Application c несколькими сценами (меню, лобби, игра, результаты)
- [ ] Настроить менеджер сцен (переключение между окнами)
- [ ] Подключить JavaFX Canvas и проверить отрисовку линий

### Блок: Сетевое взаимодействие на клиенте
- [ ] Реализовать ClientConnection (Socket, ObjectInputStream/ObjectOutputStream)
- [ ] Выделить поток для чтения из сокета
- [ ] Использовать Platform.runLater для обновления UI из сетевого потока
- [ ] Реализовать отправку структурированных сообщений (enum MessageType + JSON)
- [ ] Обработка базовых сообщений: JOIN_ACK, CHAT, ERROR

### Блок: UI — главное меню и лобби
- [ ] Главное меню: ввод имени, IP, порт, выбор “создать”/“подключиться”, выбор режима
- [ ] Кнопка “Подключиться” → отправка JOIN, переход в лобби
- [ ] Лобби: ListView игроков, кнопки “Готов”, “Старт” (только у хоста), выбор времени раунда (ComboBox/Spinner)
- [ ] Отобразить статусы игроков (готов/не готов)

### Блок: UI — режим 1 (угадай рисунок)
- [ ] Разметка: BorderPane (центр Canvas, справа чат, снизу статус)
- [ ] Реализовать Canvas-рисование (mousePressed/mouseDragged → GraphicsContext.strokeLine) и сериализацию мазков
- [ ] Панель инструментов: выбор цвета, толщины, кнопка “Очистить”
- [ ] Chat-панель: TextArea для истории, TextField + Button для отправки
- [ ] Поле “Ваша догадка” → отправка GUESS, подсветка при правильном ответе
- [ ] Отображать статус: кто художник, слово угадано ли

### Блок: UI — режим 2 (глухой телефон)
- [ ] Экран ввода текста: Label с таймером, TextArea, кнопка “Готово”
- [ ] Экран рисования по тексту: Label с фразой, Canvas, таймер, кнопка “Готово”
- [ ] Экран описания по рисунку: мини-Canvas (только чтение), TextArea, таймер, кнопка “Готово”
- [ ] Переключение между подэкранами по сообщениям ROUND_UPDATE
- [ ] Корректная блокировка UI после нажатия “Готово”

### Блок: UI — результаты
- [ ] Экран финальных цепочек: ScrollPane + VBox, внутри блоки по игрокам
- [ ] В блоке игрока попеременно текст (Label) и Canvas (отрисовка сохранённых линий)
- [ ] Кнопки “Сыграть ещё” (возврат в лобби) и “В меню”

---

## Эпик: Общие задачи (вместе)

- [x] Согласовать формат JSON сообщений и enum MessageType - смотреть в документации
- [ ] Прогнать сценарий 2 игрока (режим 1) и 4+ игроков (режим 2) в локальной(?) сети
- [ ] Проверить, что UI не фризится при сетевой нагрузке
- [ ] Проверить, что видно минимум 4 типа сообщений игроку (чат, угадывание, ход раундов, финальная цепочка)

## Бэклог (отложено)
- [ ] Изменение таймера для раундов админом
- [ ] Логирование (уровни INFO/ERROR)